# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ MegaChat

–ö–æ–º–ø–ª–µ–∫—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è MegaChat.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

### üîß `01_check_components.pl`
**–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö Perl –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Ä—Å–∏—é Perl (—Ç—Ä–µ–±—É–µ—Ç—Å—è 5.20+)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –º–æ–¥—É–ª–µ–π
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (UTF-8, –ø—Ä–∞–≤–∞ –∑–∞–ø–∏—Å–∏, –ø–æ—Ä—Ç—ã)
- –í—ã–≤–æ–¥–∏—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –º–æ–¥—É–ª–∏:**
- Mojolicious, Mojolicious::Lite
- DBI, DBD::SQLite
- JSON, Digest::MD5, Time::Piece
- Encode, File::Spec, File::Path, Cwd

### üóÑÔ∏è `02_check_database.pl`
**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∏ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ë–î
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SQLite
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ foreign keys
- –°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤

### üåê `03_check_api.pl`
**–ü—Ä–æ–≤–µ—Ä–∫–∞ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤**
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç JSON –æ—Ç–≤–µ—Ç—ã
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ò–∑–º–µ—Ä—è–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å API

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `/` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `/api/auth/check` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `/api/users/search` - –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/api/conversations` - —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
- `/api/messages/search` - –ø–æ–∏—Å–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
- `/api/notes` - –∑–∞–º–µ—Ç–∫–∏
- `/login`, `/register` - —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### üîå `04_check_websocket.pl`
**–ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–µ—á–∞—Ç–∏
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- –ò–∑–º–µ—Ä—è–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å WebSocket

### üîê `05_check_auth.pl`
**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```bash
cd megachat
perl tests/run_all_tests.pl
```

### –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
```bash
cd megachat
perl tests/01_check_components.pl
```

### –û–ø—Ü–∏–∏ —Ç–µ—Å—Ç-—Ä–∞–Ω–Ω–µ—Ä–∞
```bash
# –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
perl tests/run_all_tests.pl --verbose

# –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—â–∏–µ —Å–µ—Ä–≤–µ—Ä
perl tests/run_all_tests.pl --skip-server

# –ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º (–Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö)
perl tests/run_all_tests.pl --quick

# –°–ø—Ä–∞–≤–∫–∞
perl tests/run_all_tests.pl --help
```

## üìä –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –°—Ç–∞—Ç—É—Å—ã —Ç–µ—Å—Ç–æ–≤
- ‚úÖ **PASSED** - —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ
- ‚ùå **FAILED** - —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω, —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è
- ‚è≠Ô∏è **SKIPPED** - —Ç–µ—Å—Ç –ø—Ä–æ–ø—É—â–µ–Ω (–æ–±—ã—á–Ω–æ –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–µ—Ä–≤–µ—Ä–∞)

### –ö–æ–¥—ã –≤–æ–∑–≤—Ä–∞—Ç–∞
- `0` - –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- `1` - –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- `2` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ vs –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã** (–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ):
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ù–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã** (–ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ):
- API —Ç–µ—Å—Ç—ã
- WebSocket —Ç–µ—Å—Ç—ã  
- –¢–µ—Å—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üîß –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –î–ª—è –±–∞–∑–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –ë–î)
```bash
cd megachat
# –ù–∏–∫–∞–∫–æ–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
```

### –î–ª—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (API, WebSocket, Auth)
```bash
cd megachat
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
perl megachat.pl &

# –ò–ª–∏ –≤ —Ñ–æ–Ω–µ
nohup perl megachat.pl > server.log 2>&1 &
```

## üì¶ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ Perl –º–æ–¥—É–ª–∏:

```bash
# –î–ª—è API —Ç–µ—Å—Ç–æ–≤
cpan LWP::UserAgent HTTP::Request HTTP::Cookies

# –î–ª—è WebSocket —Ç–µ—Å—Ç–æ–≤  
cpan Protocol::WebSocket::Client

# –î–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
cpan Time::HiRes
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ì–ª–∞–≤–Ω—ã–π —Ç–µ—Å—Ç-—Ä–∞–Ω–Ω–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –ª–æ–≥:
```
megachat/tests/test_results.log
```

–õ–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
- –°—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
- –ü–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥ —Ç–µ—Å—Ç–æ–≤
- –ö–æ–¥—ã –≤–æ–∑–≤—Ä–∞—Ç–∞

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
```perl
#!/usr/bin/env perl
use strict;
use warnings;
use utf8;

print "üîç –ù–ê–ó–í–ê–ù–ò–ï –¢–ï–°–¢–ê\n";
print "=" x 50 . "\n\n";

# –õ–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–∞...

# –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
if ($success) {
    print "üéâ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù!\n";
    exit 0;
} else {
    print "‚ùå –¢–ï–°–¢ –ü–†–û–í–ê–õ–ï–ù!\n";
    exit 1;
}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Ç–µ—Å—Ç-—Ä–∞–Ω–Ω–µ—Ä
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `run_all_tests.pl`, –¥–æ–±–∞–≤–∏–≤ –Ω–æ–≤—ã–π —Ç–µ—Å—Ç –≤ –º–∞—Å—Å–∏–≤ `@tests`:

```perl
{
    name => '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞',
    file => '06_new_test.pl',
    description => '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞',
    critical => 0,  # –∏–ª–∏ 1 –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ
    requires_server => 0  # –∏–ª–∏ 1 –µ—Å–ª–∏ –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä
}
```

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
ps aux | grep megachat

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç 3000
netstat -tlnp | grep 3000

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
cd megachat && perl megachat.pl
```

### –û—à–∏–±–∫–∞ "–ú–æ–¥—É–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –º–æ–¥—É–ª–∏
cpan Module::Name

# –ò–ª–∏ —á–µ—Ä–µ–∑ local::lib
cpanm --local-lib=~/perl5 Module::Name
```

### –û—à–∏–±–∫–∞ "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª –ë–î
ls -la megachat.db

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ë–î
rm megachat.db
perl megachat.pl  # –°–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é –ë–î
```

## üìà –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ cron
```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Ç–µ—Å—Ç –≤ 02:00
0 2 * * * cd /path/to/megachat && perl tests/run_all_tests.pl --skip-server > /tmp/megachat_test.log 2>&1
```

### CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```yaml
# –ü—Ä–∏–º–µ—Ä –¥–ª—è GitHub Actions
- name: Run MegaChat Tests
  run: |
    cd megachat
    perl tests/run_all_tests.pl --skip-server
```

---

*–°–æ–∑–¥–∞–Ω–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ MegaChat –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è* üéØ
